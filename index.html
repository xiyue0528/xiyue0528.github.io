
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 4 环保词汇训练网站</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .word-card {
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }
        .word-card.flipped {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
        }
        .card-back {
            transform: rotateY(180deg);
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        @keyframes correct {
            0% { background-color: #10b981; }
            50% { background-color: #34d399; }
            100% { background-color: #10b981; }
        }
        @keyframes incorrect {
            0% { background-color: #ef4444; }
            50% { background-color: #f87171; }
            100% { background-color: #ef4444; }
        }
        .correct-animation {
            animation: correct 0.6s ease;
        }
        .incorrect-animation {
            animation: incorrect 0.6s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">
    <nav class="bg-white shadow-lg mb-8">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-bold text-green-600">🌍 Unit 4 环保词汇训练</h1>
                <div class="flex space-x-4">
                    <button onclick="showMode('home')" class="nav-btn bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">首页</button>
                    <button onclick="showMode('stats')" class="nav-btn bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">学习统计</button>
                </div>
            </div>
        </div>
    </nav>

    <div id="home-section" class="container mx-auto px-4">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">选择你的训练模式</h2>
            <p class="text-gray-600">💡 建议按顺序完成训练，循序渐进掌握词汇</p>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition">
                <div class="text-center">
                    <div class="text-4xl mb-4">📚</div>
                    <h3 class="text-xl font-bold mb-2">词汇分类学习</h3>
                    <p class="text-gray-600 mb-4">按主题分类学习词汇，建立知识体系</p>
                    <button onclick="showMode('category')" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition">开始学习</button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition">
                <div class="text-center">
                    <div class="text-4xl mb-4">🎴</div>
                    <h3 class="text-xl font-bold mb-2">单词卡片记忆</h3>
                    <p class="text-gray-600 mb-4">翻转卡片记忆单词，加深印象</p>
                    <button onclick="showMode('flashcard')" class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition">开始记忆</button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition">
                <div class="text-center">
                    <div class="text-4xl mb-4">📝</div>
                    <h3 class="text-xl font-bold mb-2">选择题测试</h3>
                    <p class="text-gray-600 mb-4">多选题形式测试词汇掌握程度</p>
                    <button onclick="showMode('quiz')" class="w-full bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600 transition">开始测试</button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition">
                <div class="text-center">
                    <div class="text-4xl mb-4">🔊</div>
                    <h3 class="text-xl font-bold mb-2">听音选词</h3>
                    <p class="text-gray-600 mb-4">听发音选择正确单词，训练听力</p>
                    <button onclick="showMode('listening')" class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition">开始听音</button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition">
                <div class="text-center">
                    <div class="text-4xl mb-4">✏️</div>
                    <h3 class="text-xl font-bold mb-2">拼写练习</h3>
                    <p class="text-gray-600 mb-4">根据中文意思拼写英文单词</p>
                    <button onclick="showMode('spelling')" class="w-full bg-yellow-500 text-white py-2 rounded-lg hover:bg-yellow-600 transition">开始拼写</button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition">
                <div class="text-center">
                    <div class="text-4xl mb-4">💬</div>
                    <h3 class="text-xl font-bold mb-2">情景对话</h3>
                    <p class="text-gray-600 mb-4">在对话中学习单词使用方法</p>
                    <button onclick="showMode('dialogue')" class="w-full bg-indigo-500 text-white py-2 rounded-lg hover:bg-indigo-600 transition">开始对话</button>
                </div>
            </div>
        </div>
    </div>

    <div id="category-section" class="container mx-auto px-4 hidden">
        <div class="max-w-4xl mx-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">📚 词汇分类学习</h2>
                <button onclick="showMode('home')" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition">返回首页</button>
            </div>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <button onclick="showCategory('weather')" class="category-btn bg-red-100 hover:bg-red-200 p-4 rounded-lg border-2 border-transparent hover:border-red-300 transition">
                    <div class="text-2xl mb-2">🌪️</div>
                    <div class="font-semibold">天气灾害</div>
                </button>
                <button onclick="showCategory('energy')" class="category-btn bg-blue-100 hover:bg-blue-200 p-4 rounded-lg border-2 border-transparent hover:border-blue-300 transition">
                    <div class="text-2xl mb-2">⚡</div>
                    <div class="font-semibold">能源类</div>
                </button>
                <button onclick="showCategory('environment')" class="category-btn bg-green-100 hover:bg-green-200 p-4 rounded-lg border-2 border-transparent hover:border-green-300 transition">
                    <div class="text-2xl mb-2">♻️</div>
                    <div class="font-semibold">环保行动</div>
                </button>
                <button onclick="showCategory('geography')" class="category-btn bg-yellow-100 hover:bg-yellow-200 p-4 rounded-lg border-2 border-transparent hover:border-yellow-300 transition">
                    <div class="text-2xl mb-2">🌍</div>
                    <div class="font-semibold">地理环境</div>
                </button>
            </div>

            <div id="category-words" class="bg-white rounded-xl shadow-lg p-6">
                <p class="text-center text-gray-500">请选择一个分类开始学习</p>
            </div>
        </div>
    </div>

    <div id="flashcard-section" class="container mx-auto px-4 hidden">
        <div class="max-w-2xl mx-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">🎴 单词卡片记忆</h2>
                <button onclick="showMode('home')" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition">返回首页</button>
            </div>

            <div class="mb-6">
                <div class="flex justify-between mb-2">
                    <span class="text-sm text-gray-600">进度</span>
                    <span class="text-sm text-gray-600" id="flashcard-progress">0/0</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="progress-bar bg-blue-500 h-2 rounded-full" id="flashcard-bar" style="width: 0%"></div>
                </div>
            </div>

            <div class="relative h-80 mb-6">
                <div id="flashcard" class="word-card w-full h-full cursor-pointer">
                    <div class="card-front bg-gradient-to-br from-blue-400 to-blue-600 text-white rounded-xl shadow-lg flex items-center justify-center text-center p-8">
                        <div>
                            <div class="text-3xl font-bold mb-4" id="word-english">点击开始</div>
                            <div class="text-sm opacity-75" id="word-phonetic"></div>
                        </div>
                    </div>
                    <div class="card-back bg-gradient-to-br from-green-400 to-green-600 text-white rounded-xl shadow-lg flex items-center justify-center text-center p-8">
                        <div>
                            <div class="text-2xl font-bold mb-4" id="word-chinese">点击翻转</div>
                            <div class="text-sm opacity-75" id="word-example"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-center space-x-4">
                <button onclick="previousCard()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition">上一个</button>
                <button onclick="flipCard()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">翻转</button>
                <button onclick="nextCard()" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition">下一个</button>
            </div>
        </div>
    </div>

    <div id="quiz-section" class="container mx-auto px-4 hidden">
        <div class="max-w-3xl mx-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">📝 选择题测试</h2>
                <button onclick="showMode('home')" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition">返回首页</button>
            </div>

            <div class="flex justify-between mb-6">
                <div class="bg-white rounded-lg p-4 shadow">
                    <div class="text-sm text-gray-600">题目进度</div>
                    <div class="text-2xl font-bold" id="quiz-progress">0/10</div>
                </div>
                <div class="bg-white rounded-lg p-4 shadow">
                    <div class="text-sm text-gray-600">正确率</div>
                    <div class="text-2xl font-bold text-green-600" id="quiz-score">0%</div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
                <div class="text-xl font-semibold mb-6" id="quiz-question">准备开始测试...</div>
                <div class="space-y-3" id="quiz-options"></div>
            </div>

            <div class="flex justify-center space-x-4">
                <button onclick="startQuiz()" id="start-quiz-btn" class="bg-purple-500 text-white px-8 py-3 rounded-lg hover:bg-purple-600 transition font-semibold">开始测试</button>
                <button onclick="nextQuiz()" id="next-quiz-btn" class="bg-green-500 text-white px-8 py-3 rounded-lg hover:bg-green-600 transition font-semibold hidden">下一题</button>
            </div>
        </div>
    </div>

    <div id="spelling-section" class="container mx-auto px-4 hidden">
        <div class="max-w-2xl mx-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">✏️ 拼写练习</h2>
                <button onclick="showMode('home')" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition">返回首页</button>
            </div>

            <div class="mb-6">
                <div class="flex justify-between mb-2">
                    <span class="text-sm text-gray-600">拼写进度</span>
                    <span class="text-sm text-gray-600" id="spelling-progress">0/20</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="progress-bar bg-yellow-500 h-2 rounded-full" id="spelling-bar" style="width: 0%"></div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
                <div class="text-center mb-6">
                    <div class="text-lg text-gray-600 mb-2">请拼写下面单词：</div>
                    <div class="text-3xl font-bold text-blue-600" id="spelling-chinese">开始练习</div>
                    <div class="text-sm text-gray-500 mt-2" id="spelling-hint"></div>
                </div>
                
                <div class="mb-6">
                    <input type="text" id="spelling-input" class="w-full p-4 text-xl border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-center" placeholder="在这里输入英文单词..." autocomplete="off">
                </div>

                <div class="text-center">
                    <button onclick="checkSpelling()" id="check-spelling-btn" class="bg-blue-500 text-white px-8 py-3 rounded-lg hover:bg-blue-600 transition font-semibold">检查拼写</button>
                    <button onclick="nextSpelling()" id="next-spelling-btn" class="bg-green-500 text-white px-8 py-3 rounded-lg hover:bg-green-600 transition font-semibold hidden">下一题</button>
                </div>

                <div id="spelling-result" class="mt-4 text-center hidden">
                    <div id="spelling-feedback" class="text-lg font-semibold mb-2"></div>
                    <div id="spelling-correct" class="text-sm text-gray-600"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="listening-section" class="container mx-auto px-4 hidden">
        <div class="max-w-2xl mx-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">🔊 听音选词</h2>
                <button onclick="showMode('home')" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition">返回首页</button>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-8 text-center">
                <p class="text-gray-600">听音选词功能开发中，敬请期待！</p>
            </div>
        </div>
    </div>

    <div id="dialogue-section" class="container mx-auto px-4 hidden">
        <div class="max-w-2xl mx-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">💬 情景对话</h2>
                <button onclick="showMode('home')" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition">返回首页</button>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-8 text-center">
                <p class="text-gray-600">情景对话功能开发中，敬请期待！</p>
            </div>
        </div>
    </div>

    <div id="stats-section" class="container mx-auto px-4 hidden">
        <div class="max-w-4xl mx-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">📊 学习统计</h2>
                <button onclick="showMode('home')" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition">返回首页</button>
            </div>

            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                    <div class="text-3xl font-bold text-blue-600" id="total-learned">32</div>
                    <div class="text-gray-600">已学习单词</div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                    <div class="text-3xl font-bold text-green-600" id="quiz-accuracy">0%</div>
                    <div class="text-gray-600">测试正确率</div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                    <div class="text-3xl font-bold text-purple-600" id="study-days">1</div>
                    <div class="text-gray-600">连续学习天数</div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">学习建议</h3>
                <div id="study-suggestions" class="space-y-2 text-gray-600">
                    <p>• 建议每天学习15-20分钟</p>
                    <p>• 重点复习错误率高的单词</p>
                    <p>• 尝试在真实情境中使用学过的单词</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const vocabulary = [
            {word: "hurricane", phonetic: "[ˈhʌrɪkən]", chinese: "飓风", category: "weather", example: "The hurricane caused severe damage."},
            {word: "flood", phonetic: "[flʌd]", chinese: "洪灾", category: "weather", example: "The flood destroyed many homes."},
            {word: "cyclone", phonetic: "[ˈsaɪkləʊn]", chinese: "气旋", category: "weather", example: "The cyclone brought heavy rain."},
            {word: "disaster", phonetic: "[dɪˈzɑːstə(r)]", chinese: "灾难", category: "weather", example: "We must prevent this disaster."},
            {word: "drown", phonetic: "[draʊn]", chinese: "淹没", category: "weather", example: "The city may drown in flood."},
            {word: "solar", phonetic: "[ˈsəʊlə(r)]", chinese: "太阳的", category: "energy", example: "Solar energy is clean."},
            {word: "nuclear", phonetic: "[ˈnjuːklɪə(r)]", chinese: "核能的", category: "energy", example: "Nuclear power is controversial."},
            {word: "hydroelectric", phonetic: "[ˌhaɪdrəʊɪˈlektrɪk]", chinese: "水力发电的", category: "energy", example: "Hydroelectric dams generate power."},
            {word: "alternative", phonetic: "[ɔːlˈtɜːnətɪv]", chinese: "替代的", category: "energy", example: "We need alternative energy sources."},
            {word: "energy", phonetic: "[ˈenədʒɪ]", chinese: "能源", category: "energy", example: "Save energy at home."},
            {word: "power", phonetic: "[ˈpaʊə(r)]", chinese: "电力", category: "energy", example: "The power went out."},
            {word: "fuel", phonetic: "[fjʊəl]", chinese: "燃料", category: "energy", example: "Cars need fuel to run."},
            {word: "reuse", phonetic: "[riːˈjuːz]", chinese: "再使用", category: "environment", example: "We should reuse plastic bags."},
            {word: "packaging", phonetic: "[ˈpækɪdʒɪŋ]", chinese: "包装", category: "environment", example: "Reduce unnecessary packaging."},
            {word: "garbage", phonetic: "[ˈgɑːbɪdʒ]", chinese: "垃圾", category: "environment", example: "Put garbage in the bin."},
            {word: "aluminum", phonetic: "[əˈlʊmɪnəm]", chinese: "铝", category: "environment", example: "Aluminum cans are recyclable."},
            {word: "plastic", phonetic: "[ˈplæstɪk]", chinese: "塑料", category: "environment", example: "Plastic pollution is serious."},
            {word: "container", phonetic: "[kənˈteɪnə]", chinese: "容器", category: "environment", example: "Use glass containers."},
            {word: "throwaway", phonetic: "[ˈθrəʊəweɪ]", chinese: "一次性的", category: "environment", example: "Avoid throwaway products."},
            {word: "ecological", phonetic: "[ˌiːkəˈlɒdʒɪkəl]", chinese: "生态的", category: "environment", example: "Ecological balance is important."},
            {word: "atmosphere", phonetic: "[ˈætməsfɪə]", chinese: "大气", category: "geography", example: "The atmosphere protects us."},
            {word: "climate", phonetic: "[ˈklaɪmɪt]", chinese: "气候", category: "geography", example: "Climate change affects everyone."},
            {word: "desert", phonetic: "[ˈdezət]", chinese: "沙漠", category: "geography", example: "The Sahara is a large desert."},
            {word: "coast", phonetic: "[kəʊst]", chinese: "海岸", category: "geography", example: "We live near the coast."},
            {word: "Netherlands", phonetic: "[ˈneðələndz]", chinese: "荷兰", category: "geography", example: "Netherlands is below sea level."},
            {word: "Spain", phonetic: "[speɪn]", chinese: "西班牙", category: "geography", example: "Spain is in Europe."},
            {word: "Greece", phonetic: "[griːs]", chinese: "希腊", category: "geography", example: "Greece has many islands."},
            {word: "critical", phonetic: "[ˈkrɪtɪkəl]", chinese: "关键的", category: "general", example: "This is a critical moment."},
            {word: "gradually", phonetic: "[ˈgrædʒuəlɪ]", chinese: "逐渐地", category: "general", example: "Things change gradually."},
            {word: "announce", phonetic: "[əˈnaʊns]", chinese: "宣布", category: "general", example: "They announced the results."},
            {word: "shock", phonetic: "[ʃɒk]", chinese: "震惊", category: "general", example: "The news shocked everyone."},
            {word: "rare", phonetic: "[reə]", chinese: "稀有的", category: "general", example: "This bird is very rare."}
        ];

        let currentMode = 'home';
        let currentCardIndex = 0;
        let currentQuizIndex = 0;
        let currentSpellingIndex = 0;
        let quizScore = 0;
        let quizQuestions = [];
        let spellingWords = [];
        let isCardFlipped = false;

        document.addEventListener('DOMContentLoaded', function() {
            showMode('home');
        });

        function showMode(mode) {
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.classList.add('hidden');
            });
            
            document.getElementById(mode + '-section').classList.remove('hidden');
            currentMode = mode;

            if (mode === 'flashcard') {
                initFlashcards();
            } else if (mode === 'spelling') {
                initSpelling();
            }
        }

        function showCategory(category) {
            const categoryWords = vocabulary.filter(word => word.category === category);
            const wordsContainer = document.getElementById('category-words');
            
            const categoryTitles = {
                weather: '🌪️ 天气灾害类词汇',
                energy: '⚡ 能源类词汇',
                environment: '♻️ 环保行动类词汇',
                geography: '🌍 地理环境类词汇'
            };

            let html = '<h3 class="text-xl font-bold mb-6">' + categoryTitles[category] + '</h3>';
            html += '<div class="grid md:grid-cols-2 gap-4">';
            
            categoryWords.forEach(word => {
                html += '<div class="border-2 border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:bg-blue-50 transition">';
                html += '<div class="flex items-center justify-between">';
                html += '<div>';
                html += '<div class="text-lg font-bold text-blue-600">' + word.word + '</div>';
                html += '<div class="text-sm text-gray-500">' + word.phonetic + '</div>';
                html += '<div class="text-gray-700">' + word.chinese + '</div>';
                html += '</div>';
                html += '<button onclick="playWord(\'' + word.word + '\')" class="text-blue-500 hover:text-blue-700 text-xl">🔊</button>';
                html += '</div>';
                html += '<div class="mt-2 text-sm text-gray-600 italic">' + word.example + '</div>';
                html += '</div>';
            });
            
            html += '</div>';
            wordsContainer.innerHTML = html;
        }

        function initFlashcards() {
            currentCardIndex = 0;
            isCardFlipped = false;
            updateFlashcard();
        }

        function updateFlashcard() {
            if (vocabulary.length === 0) return;
            
            const word = vocabulary[currentCardIndex];
            document.getElementById('word-english').textContent = word.word;
            document.getElementById('word-phonetic').textContent = word.phonetic;
            document.getElementById('word-chinese').textContent = word.chinese;
            document.getElementById('word-example').textContent = word.example;
            
            document.getElementById('flashcard-progress').textContent = (currentCardIndex + 1) + '/' + vocabulary.length;
            document.getElementById('flashcard-bar').style.width = ((currentCardIndex + 1) / vocabulary.length) * 100 + '%';
            
            document.getElementById('flashcard').classList.remove('flipped');
            isCardFlipped = false;
        }

        function flipCard() {
            const card = document.getElementById('flashcard');
            card.classList.toggle('flipped');
            isCardFlipped = !isCardFlipped;
        }

        function nextCard() {
            currentCardIndex = (currentCardIndex + 1) % vocabulary.length;
            updateFlashcard();
        }

        function previousCard() {
            currentCardIndex = currentCardIndex === 0 ? vocabulary.length - 1 : currentCardIndex - 1;
            updateFlashcard();
        }

        function startQuiz() {
            currentQuizIndex = 0;
            quizScore = 0;
            quizQuestions = generateQuizQuestions(10);
            document.getElementById('start-quiz-btn').classList.add('hidden');
            document.getElementById('next-quiz-btn').classList.add('hidden');
            showQuizQuestion();
        }

        function generateQuizQuestions(count) {
            const shuffled = vocabulary.slice().sort(function() { return 0.5 - Math.random(); });
            return shuffled.slice(0, count).map(function(word) {
                const options = [word.chinese];
                const otherWords = vocabulary.filter(function(w) { return w.word !== word.word; });
                
                while (options.length < 4) {
                    const randomWord = otherWords[Math.floor(Math.random() * otherWords.length)];
                    if (options.indexOf(randomWord.chinese) === -1) {
                        options.push(randomWord.chinese);
                    }
                }
                
                return {
                    word: word.word,
                    phonetic: word.phonetic,
                    correct: word.chinese,
                    options: options.sort(function() { return 0.5 - Math.random(); })
                };
            });
        }

        function showQuizQuestion() {
            if (currentQuizIndex >= quizQuestions.length) {
                showQuizResult();
                return;
            }

            const question = quizQuestions[currentQuizIndex];
            document.getElementById('quiz-question').innerHTML = 
                '<div class="text-center">' +
                '<div class="text-2xl font-bold text-blue-600 mb-2">' + question.word + '</div>' +
                '<div class="text-sm text-gray-500 mb-4">' + question.phonetic + '</div>' +
                '<div class="text-lg">这个单词的中文意思是：</div>' +
                '</div>';
            
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach(function(option) {
                const button = document.createElement('button');
                button.className = 'w-full p-4 text-left border-2 border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition';
                button.textContent = option;
                button.onclick = function() { selectQuizOption(button, option, question.correct); };
                optionsContainer.appendChild(button);
            });

            document.getElementById('quiz-progress').textContent = (currentQuizIndex + 1) + '/' + quizQuestions.length;
        }

        function selectQuizOption(button, selected, correct) {
            const allButtons = document.querySelectorAll('#quiz-options button');
            allButtons.forEach(function(btn) {
                btn.disabled = true;
                if (btn.textContent === correct) {
                    btn.classList.add('bg-green-500', 'text-white', 'border-green-500');
                } else if (btn === button && selected !== correct) {
                    btn.classList.add('bg-red-500', 'text-white', 'border-red-500');
                }
            });

            if (selected === correct) {
                quizScore++;
                button.classList.add('correct-animation');
            } else {
                button.classList.add('incorrect-animation');
            }

            const accuracy = Math.round((quizScore / (currentQuizIndex + 1)) * 100);
            document.getElementById('quiz-score').textContent = accuracy + '%';

            setTimeout(function() {
                document.getElementById('next-quiz-btn').classList.remove('hidden');
            }, 1000);
        }

        function nextQuiz() {
            currentQuizIndex++;
            document.getElementById('next-quiz-btn').classList.add('hidden');
            showQuizQuestion();
        }

        function showQuizResult() {
            const accuracy = Math.round((quizScore / quizQuestions.length) * 100);
            document.getElementById('quiz-question').innerHTML = 
                '<div class="text-center">' +
                '<div class="text-3xl mb-4">🎉</div>' +
                '<div class="text-2xl font-bold mb-4">测试完成！</div>' +
                '<div class="text-lg">正确率: <span class="text-green-600 font-bold">' + accuracy + '%</span></div>' +
                '<div class="text-lg">答对: ' + quizScore + '/' + quizQuestions.length + ' 题</div>' +
                '</div>';
            document.getElementById('quiz-options').innerHTML = 
                '<div class="text-center mt-4">' +
                '<button onclick="startQuiz()" class="bg-purple-500 text-white px-8 py-3 rounded-lg hover:bg-purple-600 transition font-semibold mr-4">重新测试</button>' +
                '<button onclick="showMode(\'home\')" class="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 transition font-semibold">返回首页</button>' +
                '</div>';
        }

        function initSpelling() {
            currentSpellingIndex = 0;
            spellingWords = vocabulary.slice().sort(function() { return 0.5 - Math.random(); }).slice(0, 20);
            showSpellingQuestion();
        }

        function showSpellingQuestion() {
            if (currentSpellingIndex >= spellingWords.length) {
                showSpellingResult();
                return;
            }

            const word = spellingWords[currentSpellingIndex];
            document.getElementById('spelling-chinese').textContent = word.chinese;
            document.getElementById('spelling-hint').textContent = '提示: ' + word.word.length + ' 个字母';
            document.getElementById('spelling-input').value = '';
            document.getElementById('spelling-result').classList.add('hidden');
            document.getElementById('check-spelling-btn').classList.remove('hidden');
            document.getElementById('next-spelling-btn').classList.add('hidden');

            document.getElementById('spelling-progress').textContent = (currentSpellingIndex + 1) + '/' + spellingWords.length;
            document.getElementById('spelling-bar').style.width = ((currentSpellingIndex + 1) / spellingWords.length) * 100 + '%';
        }

        function checkSpelling() {
            const userInput = document.getElementById('spelling-input').value.trim().toLowerCase();
            const correctWord = spellingWords[currentSpellingIndex].word.toLowerCase();
            const resultDiv = document.getElementById('spelling-result');
            const feedbackDiv = document.getElementById('spelling-feedback');
            const correctDiv = document.getElementById('spelling-correct');

            resultDiv.classList.remove('hidden');
            document.getElementById('check-spelling-btn').classList.add('hidden');
            document.getElementById('next-spelling-btn').classList.remove('hidden');

            if (userInput === correctWord) {
                feedbackDiv.textContent = '✅ 拼写正确！';
                feedbackDiv.className = 'text-lg font-semibold mb-2 text-green-600';
                correctDiv.textContent = spellingWords[currentSpellingIndex].word + ' - ' + spellingWords[currentSpellingIndex].chinese;
            } else {
                feedbackDiv.textContent = '❌ 拼写错误';
                feedbackDiv.className = 'text-lg font-semibold mb-2 text-red-600';
                correctDiv.innerHTML = '正确答案: <strong>' + spellingWords[currentSpellingIndex].word + '</strong> - ' + spellingWords[currentSpellingIndex].chinese;
            }

            playWord(spellingWords[currentSpellingIndex].word);
        }

        function nextSpelling() {
            currentSpellingIndex++;
            showSpellingQuestion();
        }

        function showSpellingResult() {
            document.getElementById('spelling-chinese').textContent = '🎉 拼写练习完成！';
            document.getElementById('spelling-hint').textContent = '恭喜完成所有单词的拼写练习';
            document.getElementById('spelling-input').style.display = 'none';
            document.getElementById('check-spelling-btn').style.display = 'none';
            document.getElementById('next-spelling-btn').innerHTML = '返回首页';
            document.getElementById('next-spelling-btn').onclick = function() { showMode('home'); };
        }

        function playWord(word) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const flashcard = document.getElementById('flashcard');
            if (flashcard) {
                flashcard.addEventListener('click', flipCard);
            }
        });

        document.addEventListener('keydown', function(e) {
            if (currentMode === 'flashcard') {
                if (e.code === 'Space') {
                    e.preventDefault();
                    flipCard();
                } else if (e.code === 'ArrowLeft') {
                    previousCard();
                } else if (e.code === 'ArrowRight') {
                    nextCard();
                }
            } else if (currentMode === 'spelling') {
                if (e.code === 'Enter') {
                    const checkBtn = document.getElementById('check-spelling-btn');
                    const nextBtn = document.getElementById('next-spelling-btn');
                    if (!checkBtn.classList.contains('hidden')) {
                        checkSpelling();
                    } else if (!nextBtn.classList.contains('hidden')) {
                        nextSpelling();
                    }
                }
            }
        });
    </script>
</body>
</html>
